### 开发工具评分

打开小程序开发者工具-调试器-Audits，点击运行，操作页面滚一滚点一点，然后点击停止。

### 使用了过大的 WXML 节点数目

得分标准：页面 WXML 节点少于 1000 个，节点树深度少于 30 层，子节点数不大于 60 个。

页面节点指标的意义在于，过大的节点数，过多过深的节点组成，都会增加内存使用，样式重排时间更长，影响体验。

如何统计每个模块的节点数呢？可以使用**「控制变量法」**，利用性能评测工具中，节点数超过1000时会列出节点总数的能力，我们可以在总指标超过1000的情况下，每次隐藏一个模块：

目标模块节点数  =  原总节点数  -  当前节点数

优化的两个方向：

- 页面元素按需加载，不展示时不渲染
- 长列表减少元素个数（例如减少列表接口分页数值）

### 存在图片太大而有效显示区域较小

得分标准：图片宽高乘积 <= 实际显示宽高乘积 * (设备像素比 ^ 2)

简单理解是图片尺寸太大而展示尺寸太小，导致浪费网络请求时间和内存资源。

解决方案：cdn服务商一般都支持通过参数获取不同尺寸的图片，前端可以包装一个公共方法，根据页面元素尺寸拉取合适大小的图片。

### 存在可点击元素的响应区域过小

得分标准：可点击元素的宽高都不小于 20px

移动端操作全靠手指，过小的交互区域会带来不好的体验，可以通过增大元素响应热区的方式来优化，以下方式都可以：

- `padding`
- 透明的`border`
- `box-shadow`

### 对网络请求做必要的缓存

得分标准：3 分钟以内同一个url请求不出现两次回包大于 128KB 且一模一样的内容

优化方式：

- 善用小程序的 storage 能力，做好更新和过期管理后，尽可能缓存请求到的数据。
- 针对确实需要多次请求的日志类接口，可以通过在参数内添加随机数或者时间戳的方式进行区分，避免误判。

### 存在短时间内发起太多的请求

得分标准：通过`wx.request`发起的耗时超过 300ms 的请求并发数不超过 10 个。

不同于上一项，这一项关注的是接口并发数：

- `wx.request` （HTTP 连接）的最大并发限制是 10 个
- `wx.connectSocket` （WebSocket 连接）的最大并发限制是 5 个

优化方式：

- 计算逻辑后移， 接口聚合
- 对于职责类似的网络请求，最好采用节流的方式，先在一定时间间隔内收集数据，再合并到一个请求体中发送给服务端

### 存在未绑定在wxml上的变量

得分标准：`setData`传入的所有数据都在模板渲染中有相关依赖

未绑定wxml的变量，最好优化成不使用 `setData`。

可以做的优化有：

- 与页面展示无关的内部变量，可以挂载在组件实例上，比如维护一个 `this.privateData` 对象
- 使用小程序新版本支持的「纯数据字段」：该字段不会被传递到 wxml 内，配置正则划定它的匹配范围，可以正常使用 `setData` 方法

上面策略无法覆盖的场景呢？

- 需要修改旧代码，配置纯数据字段的正则影响太大
- 京喜首页使用了 Taro 做多端适配，Taro 编译复杂逻辑的数组后会出现「影子变量」去**代理**逻辑，原本的数组变量被架空导致扣分

终极hack：

```wxml
<view wx:if={{!list && !!list}}></view>
```

这样就会被判断list变量有绑定节点，但是实际上永远不会渲染。

### 发起太多的图片请求

得分标准：同域名耗时超过 100ms 的图片请求并发数不超过 20 个

优化方式：

- 雪碧图
- 图片懒加载

