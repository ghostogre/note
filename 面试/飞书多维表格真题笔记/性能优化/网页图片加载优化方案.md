## **图片加载存在的问题和原因**

**问题一**：启动页面时加载过多图片

在 Chrome 浏览器，对于同一个域名，**最多支持 6 个请求的并发**，其他的请求将会推入到队列中等待或者停滞不前，直到六个请求之一完成后，队列中新的请求才会发出。

**问题二**：部分图片体积过大

## **前端解决方案**

**针对问题一**

新零售首页展示展示大量图片，可以延迟首屏不需要的图片加载，而优先加载首屏所需图片。这儿**首屏**的含义是指打开新零售首页首先进入屏幕视窗内的区域范围。

判断图片是否是首屏内图片，首先想到的肯定是通过 **getBoundingClientRect** 方法，获取到图片的位置信息，判断其是否在 `viewport` 内部。

**如果元素没有插入到 DOM 树中并渲染，怎么能够判断其是否在首屏中呢？**

笨办法就是，因为首页图片展示高度基本上都是固定的，哪些是首屏图片我们是可以判断的，直接在这些图片上面加上首屏渲染的标志优先加载。

**针对问题一还有些后续的解决方案：**

- 在 HTTP/1.0 和 HTTP/1.1 协议下，由于 Chrome 只支持同域同时发送 6 个并发请求，可以进行域名切分，来提升并发的请求数量，或者使用 HTTP/2 协议。

**针对问题二的解决方案**

**图片体积过大，导致下载时间过长。**在保证清晰度的前提下尽量使用体积较小的图片。而一张图片的体积由两个因素决定，该图片总的像素数目和编码单位像素所需的字节数。因此一张图片的文件大小就等于图片总像素数目乘以编码单位像素所需字节数。

对图片进行压缩处理，例如 webp 格式。