## 难点

1. 最大参与人数是6人，加上名称列和台板列一共八列。作为微信小程序，用户点击和输入是个问题（输入最好设计成列输入，这其实是设计的问题）。而且移动端最好当然是避免横向滚动了，不然的话容易和手势操作混淆。还有一种方法是自定义输入框吸在键盘上面，但是用户还是会有点击区域过小的问题（`onKeyboardHeightChange`）。

2. 输入的时候需要从回车切换下一个输入框的功能，这样需要我们配置弹起的键盘的按钮文本显示“下一个”，而且还需要注意不要发生频闪。

   > 使用input组件的`bindconfirm`事件，使用input组件的`confirm-type`可以设置按钮文本（设置为next，按钮文本会显示“下一个”）。

3. 输入数字的时候因为可以输入负数（可以欠账），这样的话一般的数字键盘不能使用了（虽然可以使用`.`开头模拟`-`，但是需要给用户注明用`.`代替`-`）。弹出 text 键盘的话，最好能够切换到数字输入（但是社区官方表示无法控制输入法切换到数字）。

   一开始，我的想法是，可以使用一个自定义吸在键盘上面的下拉选择框或者按钮（选择加减）。但是问题在于，这个自定义元素存在于键盘外，点击就会失焦（这时候是点在输入框外了）。

   最终采用`.`代替`-`，但是input输入框（`type='digit'`）在安卓环境下，有时候是不能输入`-`的，键盘输入的`-`会被输入框抛弃。而使用value传入的字符串可以是带`-`的，所以需要我们在失焦的时候把`.`替换成`-`。坑爹的是，假如你再次聚焦，输入框会马上抛弃`-`，也就是会出现聚焦输入框立刻变成正数。

4. 语音播报（同声传译）：可以使用 wx.getRecorderManager 来实现。

5. 同步更新问题：麻将助手只有一个记账人，记账人的记录需要同步到其他人查看的记录里。要求五分钟刷新一次，并且重新进入需要刷新。这需要记账的时候使用长连接每隔一段时间向后台推送一次，然后查看者才能获取更新数据。

6. input**受控组件**：

   **微信小程序**：表单组件不是完全受控的，Input 组件输入后，视图立即变化，但其 value 绑定的值还是旧值，这时你直接 setState 一个旧值会被 Taro 的 diff算法 过滤掉。例如我想要控制去除输入的非数字，当我输入第一个字符是 a 的时候，视图已经更新了，触发的 onInput 事件里我们想要修改 value 为 '' 的时候就会发现没有触发更新。这是因为 value 绑定的值是 '' 而我们更新的值也是 ''，会被diff算法排除。

   所以我们需要在修改之前先把输入的值更新到 value 上去，然后再修改。

   ```ts
   onInput(e) {
     let value = e.detail.value
     // useState 同理
     this.setState({ val: value })
     setTimeout(() => this.setState({ val: value.replace(/[^a-zA-Z]/g, '') }))
   }
   ```

   名称长度限制5个字符：

   ```ts
   let lastIndex = 0
   const len = name.split('').reduce((prev, cur, index) => {
     if (prev <= 5) {
       lastIndex = index
     }
     if (cur.charCodeAt(0) >= 0 && cur.charCodeAt(0) <= 128) {
       return prev + 1
     } else {
       return prev + 2 // 汉字算2个字符
     }
   }, 0)
   ```

   使用 selectionEnd 和 selectionStart 可以设置**聚焦时**输入框内全选（设置从开始到最后一个字符）

7. 微信小程序数字键盘和普通键盘高度是不一样的，实现下一项功能的时候需要区别数字键盘弹起或者普通键盘弹起。

8. **页面隐藏（切换APP）**的时候，键盘会收起，但是没有触发失焦事件。例如使用了键盘吸顶的按钮，切换页面之后可能会出现吸顶按钮依然停留的问题，需要在页面切换的时候及时处理。同样的，使用focus属性指定输入框的焦点的时候，即使点击输入框外如果focus的值不变是**不会失焦**的。
