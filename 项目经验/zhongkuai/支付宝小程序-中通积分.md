# 中通会员小程序

## 细节

1. 项目使用 dva 内置的`redux` + `redux-saga`。 在`app.tsx`直接导入store，就可以直接使用dvaApp的redux，以后`useSelector`和`useDispatch`。Taro默认会给你生成store目录，里面使用`redux`和`redux-thunk`

   ```jsx
   // dva.ts
   import Taro from '@tarojs/taro'
   import { create } from 'dva-core';
   import { useSelector, useDispatch } from '@tarojs/redux';
   import { createLogger } from 'redux-logger';
   // import createLoading from 'dva-loading';
   import immer from 'dva-immer';
   let app
   let store
   let dispatch
   let registered
   
   function createApp(opt) {
     // redux日志
     // opt.onAction = [createLogger()]
     app = create(opt)
     app.use(immer())
   
     // 防止重复注册
     if (!registered) opt.models.forEach(model => app.model(model))
     registered = true
     app.start()
   
     store = app._store
     app.getStore = () => store
     app.use({
       onError(err) {
         if(err.code!=212){
           Taro.showToast({
             title: err.message
           })
         }else{
           Taro.removeStorageSync('token')
           dispatch({type:'common/save', payload: {
             isLogin: false,
           }})
         }
         console.log(err);
       },
     })
   
     dispatch = store.dispatch
   
     app.dispatch = dispatch
     return app
   }
   
   export default {
     createApp,
     getDispatch() {
       return app.dispatch
     }
   }
   
   // app.tsx
   const dvaApp = dva.createApp({
     initialState: {},
     models: models,
   });
   
   const store = dvaApp.getStore();
   
   // render
   <Provider store={store}></Provider>
   ```

2. `git remote update origin --prune`  找不到新创建远程分支的时候使用，可能远程新创建了分支，但是本地的源没更新。

3. **taro脚手架的坑**：在win10中，2.2.4以及之前的版本，运行的时候会出现找不到`config/index`目录的问题。虽然说，官网说脚手架尽量与项目中保持一致，但是其实2.2.6脚手架运行2.2.4的项目是没问题的。

4. `npm config get prefix`：查看全局包安装路径。

5.  命令行脚手架一般安装在 `C:\Program Files\nodejs` 下面的node_modules。

6. `git pull origin master`：在适当的时候，每一个个人分支都需要 `pull` 一下 `master` 分支，以保证自己本地的代码的版本不会低于服务器。

## 平台差异

1. 透明渐变导航栏：支付宝小程序自己支持，在config里设置`"transparentTitle": "auto"`。
2. 带有扩展组件库，包含UI组件和营销组件。
3. API以`my.`开头。Taro 项目 支持 Taro 的代码与小程序（微信/百度/支付宝/字节跳动）原生的页面、组件代码混合存在
4. `Taro.getOpenUserInfo()`：此接口可获取支付宝会员的基础信息。如需获取支付宝会员标识（user_id），请调用 `my.getAuthCode `和 `alipay.system.oauth.token` 接口。
5. 支付宝diff算法有问题所以不能使用key。

## 我的贡献

1. 完成业务代码。
2. 重构项目时，推动项目组使用duck扁平化数据。
3. 使用key-value方法代替if else判断，抽离代码集中管理（utils），提升了代码可复用性。
4. 优化代码中大量混乱的数据，集中到js文件中过管理。