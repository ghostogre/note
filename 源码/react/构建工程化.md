react使用rollup进行构建。

### 问题：为什么react源码中很多js文件显示内容需要由具体的构建方式来填充？

**详情**：研究scheduler的时候，直接进入`/packages/scheduler/src/Scheduler.js`寻找`unstable_now`的实现。发现实际上`export { getCurrentTime as unstable_now}`，而`getCurrentTime`是从`./SchedulerHostConfig.js`导入的，代码只有一句`throw new Error('This module must be shimmed by a specific build.');`。

既然是构建的时候填充内容，回到`package.json`去查看构建相关的命令。

```json
"build": "node ./scripts/rollup/build.js",
"build-for-devtools": "cross-env RELEASE_CHANNEL=experimental yarn build react/index,react-dom,react-is,react-debug-tools,scheduler,react-test-renderer,react-refresh --type=NODE",

```

在rollup文件夹下面找到了`build.js`：

```js
// 里面大多数对函数的定义和一些处理，先找到第一个运行的函数
// 也就是文件最后一句
buildEverything()
```

如同函数名称，这是构建所有文件的入口。进入这个函数看一下具体的代码：

```js
if (!argv['unsafe-partial']) {
    // 这个函数位于./utils.js，使用rimraf删除build文件夹
    // 以包的形式包装rm -rf命令，用来删除文件和文件夹的
    await asyncRimRaf('build');
}

let bundles = [];

// [来自Bundles.bundles，来自Bundles.bundleTypes]
// 寻根溯源到./Bundles.js
for (const bundle of Bundles.bundles) {
  bundles.push(
    [bundle, NODE_ES2015],
    // ...
  );
}

// 接下来是在CI上面对于同时多任务进行打包的处理
// ...

for (const [bundle, bundleType] of bundles) {
  await createBundle(bundle, bundleType);
}

// 使用mkdirp和ncp异步拷贝移动shims代码文件到build目录下面
// build/facebook-www/shims和build/react-native/shims
await Packaging.copyAllShims();
await Packaging.prepareNpmPackages();

if (syncFBSourcePath) {
  await Sync.syncReactNative(syncFBSourcePath);
} else if (syncWWWPath) {
  await Sync.syncReactDom('build/facebook-www', syncWWWPath);
}

console.log(Stats.printResults());
if (!forcePrettyOutput) {
  Stats.saveResults();
}

```

