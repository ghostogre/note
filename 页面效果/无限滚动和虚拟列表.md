我们要实现的无限滚动是指的是，长列表滚动的时候没有分页和加载更多，滚动的时候同时渲染空白的div和请求接口，滚动的时候渲染到空白div里面，滚动过去很多位置的时候回收以前的资源，往回滚动重新加载。

触底加载，然后通过某些方法把新的元素加入到页面末尾。这样的确可以解决分页加载数据的问题，但是在一个数据量比较大的情况下，页面元素会增加得很快，这时就会导致性能问题。

页面上元素太多了，滚动的时候会有卡顿的问题，移动端上更为明显。解决方法就是减少页面元素**。

- 什么时候开始删除元素，什么时候把删了的元素显示回来
- 被删了的元素会导致高度减少，怎样保持总高度不变
- 如何确保列表元素显示在应该出现的位置
- 什么时候开始加载新数据

#### 需求

1. 在滚动的时候渲染空白div，但是还没返回数据，我们不能使用列表的ID，使用index的话假如列表顺序改变或者删除增加，会出现数据和列表无法对应（点击A商品跳到B商品的详情），最大渲染个数我们可以让后台返回total。假如我们在接口没返回数据渲染的话，我们就需要自己给他生成一个ID，例如hash值之类的。
2. TabBar切换的列表，切换的时候要保留滚动的位置，这个时候就需要做资源回收（JD的TabBar列表因为tab极其多，所以没做资源回收），不然的话tab切换太多的时候就会占用过多内存。

#### 解决

1. 虚拟列表

#### 性能测试

1. 使用`window.performance`
2. 使用`console.time`方法与`console.timeEnd`方法

#### 用户体验优化

在图像加载完成时，使用淡入（fade in）效果出现。这在实际情况上会稍微慢一下，应该慢一个过渡执行时间。但用户体验上感觉会更快。这是已经被证实且普遍应用的小“trick”。但是据我感觉，它确实有效。

#### 社区组件

社区实现虚拟列表的React组件很多，较为常用的是`react-virtualized`和`react-tiny-virtual-list`，前一个较为全面，第二个较为轻量。

但是`react-tiny-virtual-list`有一个致命的缺点：*完全不支持子元素的动态高度或者宽度*。